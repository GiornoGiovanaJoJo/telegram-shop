# Настройка платежной системы Т-Банк (Tinkoff)

## Шаг 1: Регистрация в Т-Банк

1. Перейдите на сайт [Т-Банк для бизнеса](https://www.tinkoff.ru/business/acquiring/)
2. Зарегистрируйтесь или войдите в личный кабинет
3. Подключите услугу "Интернет-эквайринг"

## Шаг 2: Получение данных для интеграции

После подключения услуги вы получите:
- **Terminal Key** (Терминальный ключ)
- **Password** (Пароль)

Эти данные можно найти в личном кабинете Т-Банк в разделе "Настройки" → "API".

## Шаг 3: Настройка конфигурации

1. Скопируйте файл `config.example.js` в `config.js`:
   ```bash
   cp config.example.js config.js
   ```

2. Откройте `config.js` и укажите ваши данные:
   ```javascript
   module.exports = {
       BOT_TOKEN: 'ваш_токен_бота',
       ADMIN_CHAT_ID: 'ваш_telegram_id',
       
       // Т-Банк настройки
       TINKOFF_TERMINAL_KEY: 'ваш_terminal_key',
       TINKOFF_PASSWORD: 'ваш_password',
       TINKOFF_API_URL: 'https://securepay.tinkoff.ru/v2/',
       
       BASE_URL: 'https://ваш-домен.com' // или 'http://localhost:3000' для разработки
   };
   ```

## Шаг 4: Установка зависимостей

Установите необходимые пакеты:
```bash
npm install
```

Это установит пакет `@sfomin/tinkoff-payment-sdk` для работы с API Т-Банк.

## Шаг 5: Настройка вебхуков

Т-Банк будет отправлять уведомления о статусе платежей на ваш сервер.

1. Убедитесь, что ваш сервер доступен из интернета
2. В личном кабинете Т-Банк укажите URL для вебхуков:
   ```
   https://ваш-домен.com/api/payment/webhook
   ```

## Шаг 6: Тестирование

### Тестовый режим

Т-Банк предоставляет тестовый режим для проверки интеграции:

1. Используйте тестовые данные из личного кабинета
2. Для тестирования используйте тестовые карты:
   - **Успешная оплата**: `2202200223948454`, срок действия любая будущая дата, CVV любой
   - **Отклоненная оплата**: `2202200223948455`

### Проверка работы

1. Запустите сервер: `npm start`
2. Создайте заказ в приложении
3. При оформлении заказа вы будете перенаправлены на страницу оплаты Т-Банк
4. После оплаты вы будете перенаправлены обратно в приложение

## Структура платежей

Платежи сохраняются в базе данных в таблице `payments` со следующими статусами:
- `pending` - Платеж создан, ожидает оплаты
- `processing` - Платеж обрабатывается
- `completed` - Платеж успешно завершен
- `failed` - Платеж отклонен или отменен
- `refunded` - Платеж возвращен

## Безопасность

⚠️ **Важно:**
- Никогда не коммитьте файл `config.js` в репозиторий
- Используйте переменные окружения в продакшене
- Убедитесь, что вебхуки защищены проверкой подписи (реализовано в коде)

## Переменные окружения

Вместо файла `config.js` можно использовать переменные окружения:

```bash
export BOT_TOKEN="ваш_токен"
export ADMIN_CHAT_ID="ваш_id"
export TINKOFF_TERMINAL_KEY="ваш_terminal_key"
export TINKOFF_PASSWORD="ваш_password"
export BASE_URL="https://ваш-домен.com"
```

## Поддержка

При возникновении проблем:
1. Проверьте логи сервера
2. Убедитесь, что все данные в `config.js` указаны правильно
3. Проверьте доступность вашего сервера из интернета для вебхуков
4. Обратитесь в поддержку Т-Банк: https://www.tinkoff.ru/business/acquiring/

## Дополнительная информация

- [Документация Т-Банк API](https://www.tinkoff.ru/kassa/develop/api/)
- [SDK для Node.js](https://github.com/slavafomin/tinkoff-payment-sdk)
