# Настройка платежной системы для ИП на Озон

## Требования к хранению данных согласно 152-ФЗ

Согласно Федеральному закону № 152-ФЗ "О персональных данных":

1. **Срок хранения персональных данных**: Данные должны храниться не дольше, чем необходимо для выполнения целей обработки
2. **Защита данных**: Необходимо обеспечить защиту от несанкционированного доступа
3. **Согласие на обработку**: Требуется согласие пользователя на обработку персональных данных
4. **Аудит**: Необходимо вести историю изменений платежей для аудита

## Структура базы данных для платежей

База данных уже настроена с учетом требований 152-ФЗ:

- **Таблица payments**: Хранит все данные о платежах
- **Таблица payment_history**: История изменений статусов платежей (для аудита)
- **Индексы**: Оптимизированы для быстрого поиска
- **Шифрование**: Рекомендуется использовать HTTPS для передачи данных

## Подключение платежной системы Озон

### Вариант 1: Ozon Pay (Рекомендуется)

Ozon Pay - это платежная система от Ozon для приема платежей.

#### Что нужно предоставить:

1. **Данные ИП:**
   - ОГРНИП (Основной государственный регистрационный номер индивидуального предпринимателя)
   - ИНН
   - ФИО индивидуального предпринимателя
   - Адрес регистрации
   - Номер телефона
   - Email

2. **Банковские реквизиты:**
   - Расчетный счет
   - БИК банка
   - Название банка
   - Корреспондентский счет

3. **Документы:**
   - Скан паспорта (главная страница и прописка)
   - Скан свидетельства о регистрации ИП
   - Скан выписки из ЕГРИП (не старше 30 дней)
   - Скан договора аренды или документ о праве собственности на помещение (если требуется)

4. **Данные для интеграции:**
   - URL вашего сайта/приложения
   - Callback URL для уведомлений о платежах
   - Email для получения уведомлений

#### Процесс подключения:

1. Зарегистрируйтесь на https://seller.ozon.ru/
2. Подайте заявку на подключение Ozon Pay
3. Пройдите верификацию (обычно 1-3 рабочих дня)
4. Получите API ключи:
   - `API_KEY` - для авторизации запросов
   - `SHOP_ID` - идентификатор магазина
   - `SECRET_KEY` - для подписи запросов

### Вариант 2: ЮKassa (Яндекс.Касса)

Альтернативный вариант - использовать ЮKassa, которая также работает с ИП.

#### Что нужно предоставить:

1. **Данные ИП** (аналогично Ozon Pay)
2. **Банковские реквизиты** (аналогично)
3. **Документы** (аналогично)

#### Процесс подключения:

1. Зарегистрируйтесь на https://yookassa.ru/
2. Подайте заявку на подключение
3. Пройдите верификацию
4. Получите API ключи

### Вариант 3: Сбербанк Эквайринг

Для ИП также доступен Сбербанк Эквайринг.

## Настройка в проекте

### 1. Установите зависимости:

```bash
npm install
```

### 2. Создайте файл `.env` или обновите `config.js`:

```javascript
module.exports = {
    BOT_TOKEN: 'ваш_токен_бота',
    ADMIN_CHAT_ID: 'ваш_chat_id',
    
    // Ozon Pay
    OZON_API_KEY: 'ваш_api_key',
    OZON_SHOP_ID: 'ваш_shop_id',
    OZON_SECRET_KEY: 'ваш_secret_key',
    
    // Или ЮKassa
    YOOKASSA_SHOP_ID: 'ваш_shop_id',
    YOOKASSA_SECRET_KEY: 'ваш_secret_key',
    
    // Callback URL
    PAYMENT_CALLBACK_URL: 'https://ваш-домен.ru/api/payment/callback'
};
```

### 3. API endpoints уже готовы:

- `POST /api/payment/create` - создание платежа
- `POST /api/payment/callback` - обработка уведомлений от платежной системы
- `GET /api/payment/status/:id` - проверка статуса платежа

## Важные моменты

1. **HTTPS обязателен** для работы с платежными системами
2. **Хранение данных**: Все данные платежей хранятся в БД согласно 152-ФЗ
3. **Безопасность**: 
   - Никогда не храните полные номера карт
   - Используйте только последние 4 цифры для отображения
   - Храните IP адреса для безопасности
4. **Аудит**: Все изменения статусов платежей записываются в `payment_history`

## Тестирование

Перед запуском в продакшн:

1. Используйте тестовые ключи от платежной системы
2. Проверьте все сценарии оплаты
3. Убедитесь, что callback работает корректно
4. Проверьте сохранение данных в БД

## Поддержка

При возникновении проблем:
- Ozon Pay: support@ozon.ru
- ЮKassa: support@yookassa.ru
- Сбербанк: 8-800-555-55-50
